generator client {
  provider = "prisma-client-js"
}

generator zod {
  provider               = "zod-prisma-types"
  output                 = "../src/schemas/generated"
  createModelTypes       = true
  createInputTypes       = false
  addInputTypeValidation = false
  useDecimalJs           = false
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum RoleUsuario {
  USER
  ADMIN
}

enum NivelProficiencia {
  BASICO
  INTERMEDIARIO
  AVANCADO
  ESPECIALISTA
}

enum TipoProjeto {
  PROJETO_FIXO
  DIÁRIA
  HORA
  CONSULTORIA
  LONGO_PRAZO
}

enum StatusProjeto {
  RASCUNHO
  ABERTO
  EM_ANDAMENTO
  CONCLUIDO
  CANCELADO
}

enum StatusProposta {
  ENVIADA
  EM_NEGOCIACAO
  ACEITA
  RECUSADA
}

model Usuario {
  id            String    @id @default(cuid())
  email         String    @unique
  senha         String
  nome          String
  fotoUrl       String?
  role          RoleUsuario @default(USER)
  ativo         Boolean   @default(true)
  criadoEm      DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  perfilCliente Cliente?
  perfilFreelancer Curriculo?

  projetosCriados Projeto[] @relation("DonoDoProjeto")
  propostasEnviadas Proposta[] @relation("AutorDaProposta")
  avaliacoesRecebidas Avaliacao[] @relation("Avaliado")
  avaliacoesFeitas    Avaliacao[] @relation("Avaliador")

  @@map("usuarios")
}

model Cliente {
  id              String    @id @default(cuid())
  usuarioId       String    @unique
  usuario         Usuario   @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  nomeFantasia    String?
  cpfOuCnpj       String?
  descricao       String?   @db.Text
  websiteUrl      String?
  localizacao     String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@map("perfil_cliente")
}

model Curriculo {
  id                        String    @id @default(cuid())
  usuarioId                 String    @unique
  usuario                   Usuario   @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  tituloProfissional        String
  resumo                    String?   @db.Text
  valorHora                 Decimal?
  portfolioUrl              String?
  githubUrl                 String?
  linkedinUrl               String?
  disponivel                Boolean   @default(true)
  experiencias  ExperienciaProfissional[]
  formacoes     FormacaoAcademica[]
  habilidades   Habilidade[]
  idiomas       Idioma[]
  certificacoes Certificacao[]
  projetosPortfolio ProjetoPortfolio[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@map("perfil_freelancer")
}

model Projeto {
  id                   String        @id @default(cuid())
  titulo               String
  descricao            String        @db.Text
  habilidadesDesejadas String[]
  tipo                 TipoProjeto
  status               StatusProjeto @default(ABERTO)
  orcamentoEstimado    String?
  prazoEstimado        String?
  remoto               Boolean       @default(true)
  criadoPorId          String
  criadoPor            Usuario       @relation("DonoDoProjeto", fields: [criadoPorId], references: [id])
  propostas            Proposta[]
  avaliacao            Avaliacao?
  dataPublicacao       DateTime      @default(now())
  updatedAt            DateTime      @updatedAt

  @@map("projetos")
}

model Proposta {
  id                 String         @id @default(cuid())
  mensagem           String         @db.Text
  valorProposto      Decimal
  prazoEstimadoDias  Int
  status             StatusProposta @default(ENVIADA)
  freelancerId       String
  freelancer         Usuario        @relation("AutorDaProposta", fields: [freelancerId], references: [id])
  projetoId          String
  projeto            Projeto        @relation(fields: [projetoId], references: [id], onDelete: Cascade)
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt

  @@unique([freelancerId, projetoId])
  @@map("propostas")
}

model Avaliacao {
  id              String   @id @default(cuid())
  nota            Int
  comentario      String?  @db.Text
  projetoId       String   @unique
  projeto         Projeto  @relation(fields: [projetoId], references: [id])
  avaliadorId     String
  avaliador       Usuario  @relation("Avaliador", fields: [avaliadorId], references: [id])
  avaliadoId      String
  avaliado        Usuario  @relation("Avaliado", fields: [avaliadoId], references: [id])
  createdAt       DateTime @default(now())

  @@map("avaliacoes")
}

// Sub-modelos do Curriculo (Experiencia, Formacao, etc) permanecem similares ao anterior, apenas garanta que apontem para Curriculo.
model ExperienciaProfissional {
  id String @id @default(cuid())
  cargo String
  empresa String
  descricao String? @db.Text
  dataInicio DateTime
  dataFim DateTime?
  atual Boolean @default(false)
  curriculoId String
  curriculo Curriculo @relation(fields: [curriculoId], references: [id], onDelete: Cascade)
  @@map("experiencias_profissionais")
}
// (Adicione os outros sub-modelos: FormacaoAcademica, Habilidade, Idioma, Certificacao seguindo o padrão)
model FormacaoAcademica {
  id String @id @default(cuid())
  instituicao String
  curso String
  dataInicio DateTime
  dataFim DateTime?
  concluido Boolean @default(true)
  curriculoId String
  curriculo Curriculo @relation(fields: [curriculoId], references: [id], onDelete: Cascade)
  @@map("formacoes_academicas")
}
model Habilidade {
  id String @id @default(cuid())
  nome String
  curriculoId String
  curriculo Curriculo @relation(fields: [curriculoId], references: [id], onDelete: Cascade)
  @@unique([curriculoId, nome])
  @@map("habilidades")
}
model Idioma {
  id String @id @default(cuid())
  nome String
  nivel NivelProficiencia
  curriculoId String
  curriculo Curriculo @relation(fields: [curriculoId], references: [id], onDelete: Cascade)
  @@unique([curriculoId, nome])
  @@map("idiomas")
}
model Certificacao {
  id String @id @default(cuid())
  nome String
  organizacaoEmissora String
  dataEmissao DateTime
  urlCredencial String?
  curriculoId String
  curriculo Curriculo @relation(fields: [curriculoId], references: [id], onDelete: Cascade)
  @@map("certificacoes")
}

model ProjetoPortfolio {
  id String @id @default(cuid())
  nome String
  descricao String? @db.Text
  projectUrl String?
  repositorioUrl String?
  dataInicio DateTime?
  dataFim DateTime?
  tecnologiasUsadas String[]
  curriculoId String
  curriculo Curriculo @relation(fields: [curriculoId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  @@map("projetos_portfolio")
}